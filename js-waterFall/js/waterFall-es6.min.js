"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value" in descriptor){descriptor.writable=true}Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps){defineProperties(Constructor.prototype,protoProps)}if(staticProps){defineProperties(Constructor,staticProps)}return Constructor}}();function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0){continue}if(!Object.prototype.hasOwnProperty.call(obj,i)){continue}target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var WaterFall=function(){function WaterFall(options){_classCallCheck(this,WaterFall);this.vm=this;this.options=this._extend(this.defaultOption,options);this.parentObj=document.querySelector(this.options.containerCls);this.subParentObj=document.querySelector(this.options.subContainerCls);this.childObj=document.querySelectorAll(this.options["childCls"]);this.childCls=this.options["childCls"].substr(1);this.subChildCls=this.options["subChildCls"].substr(1);this._init()}_createClass(WaterFall,[{key:"calculateImageWidth",value:function calculateImageWidth(){var viewportWidth=this.getDOMWidth(this.parentObj),columns=this.getColumns(),boxWidth=viewportWidth-columns*this.getGutter(this.childObj);return Math.floor(boxWidth/columns)}},{key:"getColumns",value:function getColumns(){var viewportWidth=this.getDOMWidth(this.parentObj);var ret=viewportWidth>=1024?this.options["columns"]:viewportWidth>=600?this.options["columnsPad"]:this.options["columnsMobile"];return ret}},{key:"getGutter",value:function getGutter(obj){var gutter=0,dom=obj.length>1?obj[0]:obj,css={marginLeft:"",marginRight:"",paddingLeft:"",paddingRight:""};var walker=document.createTreeWalker(dom,NodeFilter.SHOW_ELEMENT,null,false);var node=walker.nextNode();gutter+=getCSS(dom,css,this);while(node!==null){gutter+=getCSS(dom,css,this);node=walker.nextNode()}function getCSS(node,css,that){css.marginLeft=that._getStyle(node,"margin-left");css.marginRight=that._getStyle(node,"margin-right");css.paddingLeft=that._getStyle(node,"padding-left");css.paddingRight=that._getStyle(node,"padding-right");return that._toInt(css.marginLeft)+that._toInt(css.marginRight)+that._toInt(css.paddingLeft)+that._toInt(css.paddingRight)}return gutter}},{key:"getDOMWidth",value:function getDOMWidth(obj){return obj.clientWidth}},{key:"setImagePosition",value:function setImagePosition(){var imageWidth=this.calculateImageWidth(),viewportWidth=this.getDOMWidth(this.parentObj),columns=this.getColumns(),childObj=document.querySelectorAll(this.options["childCls"]),subParentObj=document.querySelector(this.options["subContainerCls"]);var boxHeight=[],minHeight=void 0,minIndex=void 0;setBoxPosition(columns,this);function setBoxPosition(columns,that){subParentObj.style.cssText=";width:"+viewportWidth+"px;margin: 0 auto;";for(var i=0;i<childObj.length;i++){var image=childObj[i].querySelector("img");image.style.cssText=";width:"+imageWidth+"px;";if(i<columns){childObj[i].style.cssText="";boxHeight.push(childObj[i].offsetHeight)}else{minHeight=Math.min.apply(null,boxHeight);minIndex=that.getMinHeightIndex(boxHeight,minHeight);childObj[i].style.cssText=";position:absolute;left:"+childObj[minIndex].offsetLeft+"px;top:"+minHeight+"px";boxHeight[minIndex]=boxHeight[minIndex]+childObj[i].offsetHeight}}}}},{key:"getMinHeightIndex",value:function getMinHeightIndex(heightList,minHeight){for(var index in heightList){if(heightList[index]===minHeight){return index}}}},{key:"isBottom",value:function isBottom(){var _scrollTop=document.documentElement.scrollTop||document.body.scrollTop,_viewPortHeight=document.documentElement.clientHeight||document.body.clientHeight,lastImageBoxTop=this.childObj[this.childObj.length-1].offsetTop;if(lastImageBoxTop<_scrollTop+_viewPortHeight){return true}}},{key:"_toInt",value:function _toInt(str){var reg=/(em|px|rem|%)+$/gi;var ret=-1;if(reg.test(str)){ret=parseInt(str.replace(reg,""))}return ret}},{key:"_getStyle",value:function _getStyle(ele,style){var ret=void 0;if(window.getComputedStyle){ret=window.getComputedStyle(ele,null).getPropertyValue(style)}else{if(style==="opacity"){var filter=null;filter=ele.style.filter.match(/progid:DXImageTransform.Microsoft.Alpha\(.?opacity=(.*).?\)/i)||ele.style.filter.match(/alpha\(opacity=(.*)\)/i);if(filter){var value=parseFloat(filter);if(!isNaN(value)){ret=value?value/100:0}}ret=1}else{if(style==="float"){ret=ele.currentStyle.getAttribute("styleFloat")}else{if((style==="width"||style==="height")&&ele.currentStyle[style]==="auto"){var clientRect=ele.getBoundingClientRect();ret=(style==="width"?clientRect.right-clientRect.left:clientRect.bottom-clientRect.top)+"px"}}}ret=ele.currentStyle.getAttribute(style)
}return ret}},{key:"_createImage",value:function _createImage(parentObj,childCls,subChildCls,url){var box=document.createElement("div"),boxImage=document.createElement("div"),image=document.createElement("img");box.className=childCls;boxImage.className=subChildCls;image.src=url;parentObj.appendChild(box);box.appendChild(boxImage);boxImage.appendChild(image)}},{key:"eventList",value:function eventList(){var vm=this.vm;window.addEventListener("resize",function(){vm.setImagePosition()});window.addEventListener("scroll",function(){if(vm.isBottom()){for(var i=0;i<vm.options["imageData"].data.length;i++){var url=vm.options["imageData"].data[i].src;vm._createImage(vm.subParentObj,vm.childCls,vm.subChildCls,url)}}vm.setImagePosition(vm.parentObj,vm.childObj)})}},{key:"_init",value:function _init(){this.setImagePosition(this.parentObj,this.childObj);this.eventList()}},{key:"_extend",value:function _extend(defOption,extOption){var ret=_objectWithoutProperties(defOption,[]);for(var key in extOption){if(ret[key]){ret[key]=extOption[key]}}return ret}}]);return WaterFall}();WaterFall.prototype.defaultOption={containerCls:"#container",subContainerCls:".content",childCls:".box",subChildCls:".box-img",widthGutter:5,columns:5,columnsPad:3,columnsMobile:2,imageData:{data:[{"src":"images/1.jpg"},{"src":"images/7.jpg"},{"src":"images/2.jpg"},{"src":"images/3.jpg"},{"src":"images/4.jpg"},{"src":"images/5.jpg"},{"src":"images/6.jpg"}]}};