function t(t){return"[object Function]"===Object.prototype.toString.call(t)}function e(t,e=2){let[i="",s=""]=t.toString().split(".");return s=s.substr(0,e),+`${i}.${s}`}!function(){if("undefined"!=typeof window){var t,e="ontouchstart"in window;document.createTouch||(document.createTouch=function(t,e,s,h,n,r,o){return new i(e,s,{pageX:h,pageY:n,screenX:r,screenY:o,clientX:h-window.pageXOffset,clientY:n-window.pageYOffset},0,0)}),document.createTouchList||(document.createTouchList=function(){for(var t=h(),e=0;e<arguments.length;e++)t[e]=arguments[e];return t.length=arguments.length,t}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(t){var e=this;do{if(e.matches(t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null});var i=function(t,e,i,s,h){s=s||0,h=h||0,this.identifier=e,this.target=t,this.clientX=i.clientX+s,this.clientY=i.clientY+h,this.screenX=i.screenX+s,this.screenY=i.screenY+h,this.pageX=i.pageX+s,this.pageY=i.pageY+h},s=!1;a.multiTouchOffset=75,e||new a}function h(){var t=[];return t.item=function(t){return this[t]||null},t.identifiedTouch=function(t){return this[t+1]||null},t}function n(e){return function(i){var h,n,a;("mousedown"===i.type&&(s=!0),"mouseup"===i.type&&(s=!1),"mousemove"!==i.type||s)&&(("mousedown"===i.type||!t||t&&!t.dispatchEvent)&&(t=i.target),null==t.closest("[data-no-touch-simulate]")&&(h=e,n=i,(a=document.createEvent("Event")).initEvent(h,!0,!0),a.altKey=n.altKey,a.ctrlKey=n.ctrlKey,a.metaKey=n.metaKey,a.shiftKey=n.shiftKey,a.touches=o(n),a.targetTouches=o(n),a.changedTouches=r(n),t.dispatchEvent(a)),"mouseup"===i.type&&(t=null))}}function r(e){var s=h();return s.push(new i(t,1,e,0,0)),s}function o(t){return"mouseup"===t.type?h():r(t)}function a(){window.addEventListener("mousedown",n("touchstart"),!0),window.addEventListener("mousemove",n("touchmove"),!0),window.addEventListener("mouseup",n("touchend"),!0)}}();const i=function(t){var e;this._self=this,this.isMoving=!1,this.canvas=document.querySelector(t.el),this.ctx=this.canvas.getContext("2d"),this.width=this.canvas.width=0|t.width,this.height=this.canvas.height=0|t.height,this.realWidth=this.canvas.clientWidth,this.realHeight=this.canvas.clientHeight,this.type=t.type,this.ctx.fillStyle=t.fillStyle||"rgba(0,0,0,0.8)",this.radius=t.radius||0,this.lineMax=t.lineMax||20,this.lineMin=t.lineMin||10,this.lineUp=t.lineUp||5,this.history=t.history||!1,this.linePressure=t.linePressure||1,this.smoothness=t.smoothness||80,this.brush=void 0!==(e=t.brush)&&e instanceof HTMLElement&&1===e.nodeType?t.brush:document.querySelector(t.brush),this.brushSize=t.brushSize||20,this.rendBG=t.rendBG||null,this.lastPos={},this.has=[],this.arr=[],this.historyCacheCurrent=[],this.historyCache=[],this.canvas.addEventListener("touchstart",this.downEvent.bind(this),!1),this.canvas.addEventListener("touchmove",this.moveEvent.bind(this),!1),this.canvas.addEventListener("touchend",this.upEvent.bind(this),!1),this.canvas.addEventListener("contextmenu",(function(t){t.preventDefault()}),!1),this.__initial__()};i.prototype.__initial__=function(){this.clear()},i.prototype.__drawBG=function(){var t=this.width,e=this.height,i={width:.8*t|0,height:.8*e|0};i.top=(e-i.height)/2|0,i.left=(t-i.width)/2|0,i.bottom=i.top+i.height,i.right=i.left+i.width;var s=this.ctx;s.strokeStyle="#e38888",s.beginPath(),s.moveTo(i.left,i.top),s.lineTo(i.right,i.top),s.lineTo(i.right,i.bottom),s.lineTo(i.left,i.bottom),s.closePath(),s.lineWidth=8,s.stroke();var h=i.left+(i.width+4)/2,n=i.top+(i.height+4)/2;i.top+=16,i.left+=16,i.bottom-=16,i.right-=16,s.beginPath(),s.moveTo(i.left,n),s.lineTo(i.right,n),s.moveTo(h,i.top),s.lineTo(h,i.bottom),s.closePath(),s.lineWidth=4,s.stroke(),s.beginPath(),s.moveTo(i.left,i.top),s.lineTo(i.right,i.top),s.lineTo(i.right,i.bottom),s.lineTo(i.left,i.bottom),s.closePath(),s.stroke()},i.prototype.__saveCache=function(t,e,i,s,h){this.history&&this.historyCacheCurrent.push({brush:t,x:e,y:i,width:s,height:h})},i.prototype.historyBack=function(){if(!this.history)throw new Error("You need to enable the history mode");if(this.historyCache.length){this.ctx.clearRect(0,0,this.width,this.height),t(this.rendBG)?this.rendBG(this):this.__drawBG(),this.historyCache.pop();var e=this.historyCache;for(var i in e){var s=e[i];for(var h in s){var n=s[h];this.ctx.drawImage(n.brush,n.x,n.y,n.width,n.height)}}}},i.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height),this.arr.length=0,this.historyCache.length=0,this.historyCacheCurrent.length=0,this.has.length=0,this.lastPos={},t(this.rendBG)?this.rendBG(this):this.__drawBG()},i.prototype.save=function(t="image/png",e=1){return this.canvas.toDataURL(t,e)},i.prototype.clickEvent=function(t){this.cli=this.getPos(t.touches[0])},i.prototype.downEvent=function(t){this.isMoving=!0,this.has=[],this.lastPos=this.getPos(t.touches[0]);var e=this.lastPos.x,i=this.lastPos.y;this.arr.unshift({x1:e,y1:i})},i.prototype.moveEvent=function(t){if(t.preventDefault(),this.isMoving){var i=this.getPos(t.touches[0]),s=this.lastPos,h=this.brushSize;this.has.unshift({time:(new Date).getTime(),dis:this.distance(s,i)});for(var n=0,r=0,o=0;o<this.has.length-1&&(n+=this.has[o].dis,r+=this.has[o].time-this.has[o+1].time,!(n>this.smoothness));o++);var a=Math.min(r/n*this.linePressure+this.lineMin,this.lineMax)/2;this.radius=a,this.lastPos=i;for(var u=Math.round(this.has[0].dis/2)+1,c=0;c<u;c++){var l=s.x+(i.x-s.x)/u*c,d=s.y+(i.y-s.y)/u*c;this.ctx.beginPath(),l-=this.brushSize/2,d-=this.brushSize/2,l=e(l),d=e(d),h=e(this.brushSize),this.arr.unshift({x:l,y:d}),this.__saveCache(this.brush,l,d,h,h),this.ctx.drawImage(this.brush,l,d,h,h),this.brushSize=h-.2,this.brushSize<this.lineMin&&(this.brushSize=this.lineMin)}}},i.prototype.upEvent=function(t){this.isMoving=!1,this.brushSize=this.lineMax;var i,s,h=this.brushSize;if(this.arr.length>100){for(var n=0;n<60;n++)this.arr[n].x=this.arr[n].x-this.brushSize/4,this.arr[n].y=this.arr[n].y-this.brushSize/4,i=e(this.arr[n].x),s=e(this.arr[n].y),h=e(this.brushSize),this.__saveCache(this.brush,i,s,h,h),this.ctx.drawImage(this.brush,i,s,h,h),this.brushSize=this.brushSize-.3,this.brushSize<this.lineUp&&(this.brushSize=this.lineUp);this.brushSize=this.lineMax,this.arr=[]}1==this.arr.length&&(i=this.arr[0].x1-this.brushSize/2,s=this.arr[0].y1-this.brushSize/2,i=e(i),s=e(s),h=e(this.brushSize),this.__saveCache(this.brush,i,s,h,h),this.ctx.drawImage(this.brush,i,s,h,h),this.arr=[]),this.historyCache.push(this.historyCacheCurrent),this.historyCacheCurrent=[]},i.prototype.getPos=function(t){var e=this.canvas.getBoundingClientRect(),i=t.clientX,s=t.clientY,h=Math.round(i-e.left),n=Math.round(s-e.top);return{x:h=h*this.width/this.realWidth,y:n=n*this.height/this.realHeight}},i.prototype.distance=function(t,e){let i=e.x-t.x,s=e.y-t.y;return Math.sqrt(i*i+s*s)};export default i;
